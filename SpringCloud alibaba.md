# Spring cloud Alibaba 组件
# 远程调用Feign
## 动态代理介绍
动态代理：是使用反射和字节码的技术，在运行期创建指定接口或类的子类以及其实例对象的技术，通过这个技术可以无侵入的为代码进行增强。

## 动态代理的实现方式
Java中动态代理主要有JDK和CGLIB两种方式。

## JDK实现的动态代理
### JDK实现动态代理介绍。
JDK实现的动态代理由两个重要的成员组成，分别是Proxy、InvocationHandler

+ Proxy： 是所有动态代理的父类，它提供了一个静态方法来创建动态代理的class对象和实例

+ InvocationHandler： 每个动态代理实例都有一个关联的InvocationHandler，在代理实例上调用方法是，方法调用将被转发到InvocationHandler的invoke方法
	启动类上开启FeignClient注解，会扫描当前包及其子包下有FeignClient注解的接口
	并创建这些接口实现代理类，创建代理类对象放入容器中。
	调用时，实际上是代理类对象调用，
	1、代理类对象可以获取到当前类的实现的接口，
	2、根据接口获取到接口上的注解，
	3、根据注解获取到注解的属性值
	4、获取当前方法的引用
	5、获取方法上的注解
	6、获取传入的参数
	7、然后拼接url和参数
	8、通过feign集成的ribbon,拿到本地缓存列表将服务名替换
	9、内部使用restTemplate进行网络调用
	10、根据方法的返回值将应答进行解析

#  熔断降级Sentinel
## 常见的容错组件
+ Hystrix:Netflfix
+ Resilience4J:Hystrix
+ Sentinel:Alibaba
## 常见的容错的思路
### 隔离
给不同的服务分配固定的线程，不要把所有的线程都分配给某个服务，这样进行资源的隔离
### 超时
+ 在上游服务调用调用下游服务的时候，设置一个最大相应时间没如果超时未相应，则断开请求，释放线程。
+ 在调用第三方服务时，应为第三方的接口相应时间不可控，一般会新起一个线程去调用第三方线程，自己应用会先返回响应给请求方。
### 限流
限制系统的输入和输出流量来达到保护系统的目的，保证系统的稳固运行。
### 熔断
当下游服务因访问压力过大而响应变慢或者崩掉，上游服务为了保护系统整体可用，可以先暂时切断对下游服务的调用。
服务熔断一般有三种状态
+ 熔断关闭状态(closed)
服务没有故障时，熔断器所处的状态，对调用方的调用不做任何限制
+ 熔断关闭状态(closed)
后续对该服务接口的调用不在经过网络，直接执行本地的fallback方法
+ 半熔断状态(Half-Open)
尝试恢复服务调用，允许有限的流量调用，并监控调用成功率。若成功率达到预期，则说明服务已经恢复，若果成功率很低，则重新进入熔断开启状态。
### 降级
为服务提供一个默认响应。
## Sentinel
Sentinel(分布式系统的流量防卫兵)，以流量为切入点，从流量控制、熔断降级、系统负载保护维持稳定。
Sentinel分为两个部分：
+ 核心库(Java客户端)不依赖任何框架/库，能够运行于所有jre
+ 控制台(Dashboard)基于springboot开发，打包后可以直接运行。
### Sentinel规则
+ 流控
+ 降级
+ 热点
+ 授权
	Sentinel来源访问控制(黑白名单控制)
+ 系统规则
	1. LOAD
	2. RT比例
	3. 线程数
	4. 入口QPS
	5. CPU使用率
### Sentinel自定义异常
+ 限流异常FlowException
+ 降级异常DegradeException
+ 参数限流异常ParamFlowException
+ 授权异常AuthorityException
+ 系统负载异常SystemBlockException